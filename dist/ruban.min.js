// ruban v0.1.2
//
// Copyright (c) 2013 Lo√Øc Frering <loic.frering@gmail.com>
// Distributed under the MIT license
(function(){var t;t=function(){function t(i){var n=this;this.options=null!=i?i:{},this.next=function(){return t.prototype.next.apply(n,arguments)},this.prev=function(){return t.prototype.prev.apply(n,arguments)},this.checkHash=function(){return t.prototype.checkHash.apply(n,arguments)},this.initOptions(),this.$sections=$("section").wrapAll('<div class="ruban"></div>'),this.$ruban=$(".ruban"),this.$current=this.$sections.first(),this.toc(),this.checkHash(),this.highlight(),this.resize(),this.bind(),this.$ruban.css("transition-duration",this.options.transitionDuration)}return t.prototype.initOptions=function(){var t,i,n,e,s,r,o,h;return null==(s=(t=this.options).ratio)&&(t.ratio=4/3),null==(r=(i=this.options).minPadding)&&(i.minPadding="0.4em"),null==(o=(n=this.options).transitionDuration)&&(n.transitionDuration="1s"),null!=(h=(e=this.options).pagination)?h:e.pagination=!1},t.prototype.bind=function(){return this.bindKeys(),this.bindGestures(),this.bindResize(),this.bindHashChange()},t.prototype.bindKeys=function(){return key("right, down, space, return, j, l",this.next),key("left, up, backspace, k, h",this.prev)},t.prototype.bindGestures=function(){return Hammer(document).on("swipeleft swipeup",this.next),Hammer(document).on("swiperight swipedown",this.prev)},t.prototype.bindResize=function(){var t=this;return $(window).resize(function(){return t.resize(),t.go(t.$current,{force:!0})})},t.prototype.bindHashChange=function(){return $(window).on("hashchange",this.checkHash)},t.prototype.resize=function(){var t,i,n,e,s,r,o,h;return h=[$(window).width(),$(window).height()],e=h[0],n=h[1],e>this.options.ratio*n?(i=n,r=this.options.minPadding,this.$ruban.parent().css("font-size",""+.4*i+"%"),this.$sections.css({"padding-top":r,"padding-bottom":r}),t=this.$current.height(),o=this.options.ratio*t,s=""+(e-o)/2+"px",this.$sections.css({"padding-left":s,"padding-right":s})):(i=e/this.options.ratio,s=this.options.minPadding,this.$ruban.parent().css("font-size",""+.4*i+"%"),this.$sections.css({"padding-left":s,"padding-right":s}),o=this.$current.width(),t=o/this.options.ratio,r=""+(n-t)/2+"px",this.$sections.css({"padding-top":r,"padding-bottom":r}))},t.prototype.checkHash=function(){var t,i;return t=window.location.hash,i=t.substr(2)||1,this.go(i)},t.prototype.highlight=function(){return hljs.initHighlightingOnLoad()},t.prototype.prev=function(){return this.hasSteps()?this.prevStep():this.prevSlide()},t.prototype.prevSlide=function(){var t;return t=this.$current.prev("section"),this.go(t)},t.prototype.prevStep=function(){var t;return this.$steps.eq(this.index).removeClass("step").fadeOut(),t=this.$steps.eq(--this.index),-1>this.index?this.prevSlide():t.is(":visible")?t.addClass("step").trigger("step"):this.index>-1?this.prevStep():void 0},t.prototype.next=function(){return this.hasSteps()?this.nextStep():this.nextSlide()},t.prototype.nextSlide=function(){var t;return t=this.$current.next("section"),this.go(t)},t.prototype.nextStep=function(){var t;return this.$steps.eq(this.index).removeClass("step"),t=this.$steps.eq(++this.index),t.length?t.fadeIn().addClass("step").trigger("step"):this.nextSlide()},t.prototype.checkSteps=function(t){return this.$steps=t.find(".steps").children(),this.$steps.length||(this.$steps=t.find(".step")),this.index=-1,this.$steps.hide()},t.prototype.hasSteps=function(){return null!=this.$steps&&0!==this.$steps.length},t.prototype.find=function(t){var i;return t instanceof $?t:(i=$("#"+t),0===i.length&&(i=this.$sections.eq(parseInt(t)-1)),i)},t.prototype.go=function(t,i){var n,e;return null==t&&(t=1),null==i&&(i={}),n=this.find(t),n.length&&(i.force||!n.is(this.$current))&&(this.checkSteps(n),window.location.hash="/"+(n.attr("id")||n.index()+1),e=n.prevAll().map(function(){return $(this).outerHeight()}).get().reduce(function(t,i){return t+i},0),this.$ruban.css("transform","translateY(-"+e+"px)"),null!=this.$current&&this.$current.removeClass("active").trigger("inactive"),n.addClass("active").trigger("active"),this.$current=n,this.options.pagination)?this.pagination():void 0},t.prototype.pagination=function(){return this.$pagination||(this.$ruban.parent().append('<footer class="pagination"></footer>'),this.$pagination=$(".pagination"),this.total=this.$sections.length),this.$pagination.html(""+(this.$current.index()+1)+"/"+this.total)},t.prototype.toc=function(){var t,i;return t=$(".toc"),t.length?(i=$("<ul/>"),$("section:not(.no-toc) > h1:only-child").each(function(){var t,n;return t=$(this).parent(),n=$(this).text(),i.append($("<li/>")).append($("<a/>",{href:"#/"+(t.attr("id")||t.index()+1),title:n,text:n}))}),t.append("<h1>Table of Contents</h1>").append(i)):void 0},t}(),window.Ruban=t}).call(this);